# API de Val **üìä ESTADO ACTUAL DE SERVICIOS GUBERNAMENTALES**:
> - ‚úÖ **Formulario AIN solucionado**: La vulnerabilidad en https://tramites.ain.gub.uy ha sido corregida mediante autenticaci√≥n requerida
> - ‚ùå **Formularios MEF inoperativos**: Los formularios del Ministerio de Econom√≠a rechazan c√©dulas v√°lidas como inv√°lidas
> - ‚ùå **Formularios de Loter√≠a inoperativos**: Todos los formularios que requieren c√©dula permanecen fuera de servicio desde 31/07/2025
> 
> **üìä Estado actual**: Mejoras en seguridad implementadas, algunos servicios a√∫n presentan problemas operativos. de C√©dulas Uruguayas

> **üìÖ ACTUALIZACI√ìN T√âCNICA 04/08/2025**: 
> 
> **ÔøΩ MEJORAS IMPLEMENTADAS**:
> - ‚úÖ **Extracci√≥n de datos mejorada**: Soporte para el nuevo formato de formularios AIN_FRM_GRAL_DATOS_PERSONALES
> - ‚úÖ **Informaci√≥n adicional**: Tipo de documento, pa√≠s emisor, y componentes individuales de nombres y apellidos
> - ‚úÖ **Manejo de errores optimizado**: Mensajes m√°s descriptivos y manejo espec√≠fico por tipo de error
> - ‚úÖ **Validaci√≥n mejorada**: Verificaci√≥n de formato de c√©dula antes del procesamiento
> - ‚úÖ **Compatibilidad dual**: Funciona con formatos antiguos y nuevos de formularios gubernamentales
> - ‚úÖ **Logging mejorado**: Mayor detalle en los logs para debugging y monitoreo
> 
> **ÔøΩüö® CRISIS OPERACIONAL GUBERNAMENTAL**: El endpoint vulnerable fue deshabilitado, pero esto **ROMPI√ì COMPLETAMENTE** el sistema de tr√°mites:
> - ‚ùå **Formularios de identificaci√≥n NO FUNCIONAN**: Cualquier c√©dula ingresada es rechazada como "inv√°lida"
> - ‚ùå **Tr√°mites para personas f√≠sicas IMPOSIBLES**: Los ciudadanos no pueden completar tr√°mites que requieren identificaci√≥n con c√©dula
> - ‚ö†Ô∏è **Otros formularios A√öN VULNERABLES**: El endpoint sigue activo en otros formularios gubernamentales con autocompletado de datos personales
> - üîÑ **Soluci√≥n incompleta**: Se deshabilit√≥ solo UN formulario, pero la vulnerabilidad persiste en m√∫ltiples puntos del sistema
> 
> **üìä Estado actual**: Los servicios gubernamentales est√°n **PARCIALMENTE ROTOS** - ni seguros ni funcionales.
> 
> Ver [reporte completo actualizado](./SECURITY_VULNERABILITY.md) para detalles t√©cnicos.

## ÔøΩ Contexto de Seguridad P√∫blica

> ### ‚ö†Ô∏è **Informaci√≥n para Ciudadanos Uruguayos**
> 
> **Este proyecto surge del an√°lisis de seguridad en sistemas p√∫blicos debido a:**
> 
> ÔøΩ **Ausencia de programas de recompensas** por reportes de seguridad en entidades p√∫blicas  
> ÔøΩ **Falta de canales formales** para reportar vulnerabilidades en sistemas gubernamentales  
> ÔøΩ **Necesidad de transparencia** en el estado de la ciberseguridad p√∫blica  
> üîç **Importancia de la educaci√≥n ciudadana** sobre protecci√≥n de datos personales  
> 
> **üéØ Objetivo**: Informar sobre el estado de los sistemas inform√°ticos p√∫blicos y promover mejores pr√°cticas de seguridad en el manejo de informaci√≥n ciudadana.
>
> **üìã Este proyecto contribuye a:**
> - Generar conciencia sobre la importancia de la ciberseguridad p√∫blica
> - Documentar el estado actual de los sistemas gubernamentales
> - Promover la transparencia en la gesti√≥n de sistemas p√∫blicos
> - Educar sobre buenas pr√°cticas de protecci√≥n de datos
>
> Consulte el [**üìÑ Reporte de Vulnerabilidades**](./SECURITY_VULNERABILITY.md) para informaci√≥n t√©cnica detallada.

---

Una API RESTful construida con TypeScript y Express siguiendo los principios SOLID para validar c√©dulas de identidad uruguayas y consultar informaci√≥n a trav√©s del formulario oficial del MEF (Ministerio de Econom√≠a y Finanzas).

## üÜï Nuevas Caracter√≠sticas (Agosto 2025)

### üìã **Extracci√≥n de Datos Mejorada**
- **Tipo de documento**: Identifica si es C√©dula de Identidad, Pasaporte u Otro
- **Pa√≠s emisor**: Detecta el pa√≠s que emiti√≥ el documento (Uruguay, Argentina, etc.)
- **Componentes individuales**: Extrae primer nombre, segundo nombre, primer apellido, segundo apellido por separado
- **Compatibilidad dual**: Funciona con formatos antiguos y nuevos de formularios

### üîß **Mejoras T√©cnicas**
- **Validaci√≥n previa**: Verifica formato de c√©dula antes del procesamiento
- **Manejo de errores optimizado**: Mensajes espec√≠ficos por tipo de error
- **Logging avanzado**: Mayor detalle para debugging y monitoreo
- **Performance mejorado**: Tiempos de procesamiento optimizados
- **Configuraci√≥n validada**: Verificaci√≥n autom√°tica de configuraci√≥n del servicio

### üìä **Datos Adicionales Extra√≠dos**
```json
{
  "success": true,
  "data": {
    "persona": {
      "nombre": "EDELMA",
      "apellido": "de SOUZA", 
      "cedula": "14115499",
      "tipoDocumento": "C√©dula de Identidad",
      "paisEmisor": "URUGUAY",
      "primerNombre": "EDELMA",
      "primerApellido": "de SOUZA",
      "processingTime": 1250,
      "hasSession": true
    }
  }
}
```

## üì¶ Paquete NPM Disponible

**¬°Esta funcionalidad tambi√©n est√° disponible como paquete npm!**

```bash
# Instalar el paquete
npm install ci-validation

# Uso b√°sico
import { validateCIAndQuery } from 'ci-validation';
const result = await validateCIAndQuery('19119365');
console.log(result);
// Output (solo validaci√≥n local - endpoints gubernamentales inhabilitados):
// {        
//   "success": true,
//   "data": {
//     "ci": "19119365",
//     "isValid": true,
//     "normalizedCi": "19119365",
//     "info": "Validaci√≥n local √∫nicamente - Servicios gubernamentales no disponibles desde 02/08/2025"
//   }
// }
```

üîó **Enlaces del paquete**:
- **npm**: https://www.npmjs.com/package/ci-validation
- **Documentaci√≥n completa**: [NPM_README.md](./NPM_README.md)
- **Gu√≠a de publicaci√≥n**: [NPM_PUBLISHING.md](./NPM_PUBLISHING.md)

## üöÄ Caracter√≠sticas

- **üì¶ Paquete NPM**: Disponible como librer√≠a independiente para proyectos TypeScript/JavaScript
- **üîß CLI incluido**: Herramienta de l√≠nea de comandos para validaci√≥n r√°pida
- **Validaci√≥n de CI**: Valida el formato y d√≠gito verificador de c√©dulas uruguayas
- **Consulta de datos**: Obtiene informaci√≥n oficial a trav√©s del formulario del MEF
- **Arquitectura SOLID**: Implementa los 5 principios SOLID para c√≥digo mantenible
- **TypeScript**: Tipado est√°tico para mayor robustez
- **Express.js**: Framework web r√°pido y minimalista
- **Middlewares de seguridad**: CORS, Helmet, Rate Limiting
- **Listo para Vercel**: Configuraci√≥n optimizada para deployment

## üìã Principios SOLID Implementados

### S - Single Responsibility Principle (SRP)
- `CiValidator`: Solo se encarga de validar c√©dulas
- `CiService`: Solo maneja las consultas a la API externa
- `CiController`: Solo maneja las peticiones HTTP

### O - Open/Closed Principle (OCP)
- Interfaces extensibles para validadores y servicios
- Nuevos tipos de validaci√≥n pueden agregarse sin modificar c√≥digo existente

### L - Liskov Substitution Principle (LSP)
- Las implementaciones de interfaces pueden intercambiarse sin afectar el funcionamiento

### I - Interface Segregation Principle (ISP)
- Interfaces espec√≠ficas y peque√±as
- No hay dependencias en m√©todos no utilizados

### D - Dependency Inversion Principle (DIP)
- Dependencias por inyecci√≥n de dependencias
- C√≥digo de alto nivel no depende de implementaciones concretas

## üõ†Ô∏è Instalaci√≥n

### Como Paquete NPM (Recomendado)

```bash
# Instalar la librer√≠a
npm install ci-validation

# Uso b√°sico
import { validateCI, validateCIAndQuery } from 'ci-validation';

// Validaci√≥n simple
console.log(validateCI('19119365')); // true

// Validaci√≥n con consulta (servicios gubernamentales con disponibilidad limitada)
const result = await validateCIAndQuery('19119365');
console.log(result);
```

### Instalaci√≥n Global (CLI)

```bash
# Instalar globalmente para usar desde l√≠nea de comandos
npm install -g ci-validation

```bash
# Usar el CLI
ci-validate 19119365
ci-validate 19119365 --query  # Consulta a servicios gubernamentales (disponibilidad limitada)
```
```

### Clonar el Repositorio (Desarrollo)

```bash
# Clonar repositorio
git clone <url-del-repo>
cd ci-validation-api

# Instalar dependencias
npm install

# Modo desarrollo
npm run dev

# Construir para producci√≥n
npm run build

# Iniciar en producci√≥n
npm start
```

## üì° Endpoints

### GET /health
Verifica el estado de la API

**Respuesta:**
```json
{
  "status": "ok",
  "timestamp": "2025-07-30T12:00:00.000Z"
}
```

### POST /api/ci/validate
Valida una c√©dula de identidad uruguaya

**Request Body:**
```json
{
  "ci": "19119365"
}
```

**Respuesta exitosa:**
```json
{
  "success": true,
  "data": {
    "ci": "19119365",
    "isValid": true,
    "info": "Informaci√≥n obtenida del formulario oficial del MEF..."
  }
}
```

**Respuesta con error:**
```json
{
  "success": false,
  "error": "C√©dula inv√°lida: formato incorrecto"
}
```

### GET /api/ci/demo
Endpoint de demostraci√≥n con una c√©dula de ejemplo

### GET /demo
P√°gina web interactiva para probar la API

La p√°gina de demostraci√≥n incluye:
- **Interfaz amigable**: Formulario simple para ingresar c√©dulas
- **Validaci√≥n en tiempo real**: Feedback inmediato sobre errores de formato
- **Respuesta dual**: Muestra tanto la respuesta JSON como un resultado amigable
- **Persistencia en URL**: La c√©dula se mantiene en la URL al recargar
- **Ejemplos**: Botones para probar c√©dulas de ejemplo
- **Responsive**: Funciona en dispositivos m√≥viles y desktop
- **Indicadores visuales**: Animaciones y colores para success/error

**Caracter√≠sticas t√©cnicas:**
- Uso de Tailwind CSS para estilos
- JavaScript vanilla para m√°ximo rendimiento
- Font Awesome para iconos
- Manejo de errores robusto
- Validaci√≥n del lado cliente antes de enviar

## üß™ Testing

```bash
# Ejecutar tests
npm test

# Ejecutar linting
npm run lint

# Corregir problemas de linting
npm run lint:fix
```

## üöÄ Deployment en Vercel

1. Conecta tu repositorio con Vercel
2. Vercel detectar√° autom√°ticamente la configuraci√≥n
3. Las variables de entorno se configuran en el dashboard de Vercel

### Configuraci√≥n para Vercel

El proyecto est√° optimizado para deployment serverless en Vercel:

- **Funciones serverless**: Los endpoints est√°n en la carpeta `/api/`
- **Archivos est√°ticos**: La p√°gina demo est√° en `/public/`
- **Configuraci√≥n autom√°tica**: `vercel.json` maneja el routing
- **Build autom√°tico**: TypeScript se compila autom√°ticamente

### Estructura de Deployment

```
api/
‚îú‚îÄ‚îÄ index.ts          # Endpoint ra√≠z (GET /)
‚îú‚îÄ‚îÄ health.ts         # Health check (GET /health)
‚îú‚îÄ‚îÄ validate.ts       # Validaci√≥n (POST /api/ci/validate)
‚îî‚îÄ‚îÄ demo.ts          # Demo API (GET /api/ci/demo)
public/
‚îî‚îÄ‚îÄ index.html       # P√°gina demo (GET /demo)
```

### URLs en Producci√≥n

- **API Root**: `https://ci-validation.vercel.app/`
- **Health Check**: `https://ci-validation.vercel.app/health`
- **Validaci√≥n**: `https://ci-validation.vercel.app/api/ci/validate`
- **Demo Page**: `https://ci-validation.vercel.app/demo`

### Variables de Entorno

- `NODE_ENV`: `production`
- `PORT`: Puerto del servidor (autom√°tico en Vercel)

## üìÅ Estructura del Proyecto

```
src/
‚îú‚îÄ‚îÄ controllers/          # Controladores HTTP
‚îÇ   ‚îî‚îÄ‚îÄ CiController.ts
‚îú‚îÄ‚îÄ services/            # Servicios de negocio
‚îÇ   ‚îî‚îÄ‚îÄ CiService.ts
‚îú‚îÄ‚îÄ validators/          # Validadores
‚îÇ   ‚îî‚îÄ‚îÄ CiValidator.ts
‚îú‚îÄ‚îÄ interfaces/          # Definiciones de tipos
‚îÇ   ‚îú‚îÄ‚îÄ ICiValidator.ts
‚îÇ   ‚îú‚îÄ‚îÄ ICiService.ts
‚îÇ   ‚îî‚îÄ‚îÄ ApiResponse.ts
‚îú‚îÄ‚îÄ middleware/          # Middlewares personalizados
‚îÇ   ‚îî‚îÄ‚îÄ errorHandler.ts
‚îú‚îÄ‚îÄ routes/             # Definici√≥n de rutas
‚îÇ   ‚îî‚îÄ‚îÄ ciRoutes.ts
‚îú‚îÄ‚îÄ utils/              # Utilidades
‚îÇ   ‚îî‚îÄ‚îÄ dependencyContainer.ts
‚îî‚îÄ‚îÄ index.ts            # Punto de entrada
```

## üîí Seguridad

- **CORS**: Configurado para permitir requests desde dominios espec√≠ficos
- **Helmet**: Headers de seguridad autom√°ticos
- **Rate Limiting**: L√≠mite de requests por IP
- **Validaci√≥n de entrada**: Validaci√≥n estricta de datos de entrada

## üìù Algoritmo de Validaci√≥n de CI

La validaci√≥n sigue el algoritmo oficial uruguayo:
1. Verificar que tenga 7-8 d√≠gitos
2. Calcular d√≠gito verificador usando el algoritmo oficial
3. Comparar con el √∫ltimo d√≠gito de la c√©dula

## ü§ù Contribuci√≥n

1. Fork el proyecto
2. Crea una rama para tu feature (`git checkout -b feature/AmazingFeature`)
3. Commit tus cambios (`git commit -m 'Add some AmazingFeature'`)
4. Push a la rama (`git push origin feature/AmazingFeature`)
5. Abre un Pull Request

### üì¶ Publicar el Paquete NPM

Si tienes permisos de publicaci√≥n:

```bash
# Verificar build
npm run build

# Dry run
npm run publish:dry

# Publicar
npm run publish:npm

# O incrementar versi√≥n y publicar
npm version patch  # o minor/major
npm run publish:npm
```

Ver [gu√≠a completa de publicaci√≥n](./NPM_PUBLISHING.md) para m√°s detalles.

## üìÑ Licencia

Este proyecto est√° bajo la Licencia MIT. Ver el archivo `LICENSE` para m√°s detalles.

## üîó Enlaces √ötiles

### üìñ Documentaci√≥n T√©cnica
- [Documentaci√≥n de Express](https://expressjs.com/)
- [TypeScript Handbook](https://www.typescriptlang.org/docs/)
- [Principios SOLID](https://en.wikipedia.org/wiki/SOLID)
- [Vercel Documentation](https://vercel.com/docs)

### üì¶ Paquete NPM
- **[üìö Documentaci√≥n del Paquete NPM](./NPM_README.md)** - Gu√≠a completa de uso de la librer√≠a
- **[üöÄ Gu√≠a de Publicaci√≥n NPM](./NPM_PUBLISHING.md)** - Instrucciones para publicar actualizaciones
- **[npm Package](https://www.npmjs.com/package/ci-validation)** - P√°gina oficial del paquete

### ‚ö†Ô∏è Seguridad
- **[‚ö†Ô∏è Reporte de Vulnerabilidad de Seguridad](./SECURITY_VULNERABILITY.md)** - Informaci√≥n sobre la vulnerabilidad encontrada en servicios gubernamentales
- **[ÔøΩ Informe T√©cnico de Vulnerabilidad IDOR](./TECHNICAL_VULNERABILITY_REPORT.md)** - An√°lisis t√©cnico detallado de la vulnerabilidad
- **[ÔøΩüõ°Ô∏è Pol√≠tica de Seguridad y VDP](./SECURITY.md)** - Programa de Divulgaci√≥n Responsable de Vulnerabilidades
